<!DOCTYPE html>
<html>
<head>
  <!-- basic script -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser.js"></script>
</head>
<body>

  <script>
    const words = new Set(["honeypot", "neophyte", "phenotype", "eyeteeth", "eyetooth", "honey", "hooey", "hoppy", "hype", "hyphen", "hypo", "netty", "penny", "peony", "peppy", "petty", "peyote", "phony", "phooey", "pony", "poppy", "potty", "python", "teeny", "they", "tony", "toothy", "type", "typhoon", "typo", "yente", "yoohoo"]);

    var letters = ["n", "t", "p", "e", "y", "o", "h", "←","↻ "]; // first letter 
    var freeLetters = ["h", "o", "n", "e","p", "t"];
    var string = "";

    var shakeCamera;
    var graphics;



    var config = {
      type: Phaser.WEBGL,
      width: 1000,
      height: 1000,
      backgroundColor: "FFFFFF",

      scene: {
        preload: preload,
        create: create,
      }
    };

    var game = new Phaser.Game(config);
    var squares = [];
    var textBoxes = [];
    var currentWord;
    var camera;


    function preload ()
    {
     this.load.image('square', 'assets/square.png');
     this.load.image('submit', 'assets/submit.png');
   }

   function create ()
   {
    camera = this.cameras.main;

    // this.cameras.main.setViewport(5, 5, 1000, 1000);


    // shakeCamera = this.cameras.add(405, 305, 390, 290);
    // shakeCamera.shake(300);


    currentWord = this.add.text(405, 75, "", { font: "70px Karla", fill: '#000000' });
    currentWord.setOrigin(0.5);

    const submit = this.add.sprite(400, 515, 'submit');
    // var submit = this.add.text(330, 485, "submit", { font: "40px Karla", fill: '#F5C50B' });
    submit.setInteractive();

    submit.on('pointerup', function() {
      check();
    });

    // make grid
    var width = 300;
    var height = 100; 
    for(i = 0; i < 9; i++){
      var image = 'square';
      if(i % 3 == 0) {
        width = 300;
        height += 105;
      }
      else {
        width += 105;
      }
      const square = this.add.sprite(width, height, image);
      square.tint = 0xE0E0E0;

      if(i == 4) { // special square
        square.tint = 0xF5C50B;
      }
      if(i == 7 || i == 8) { // oh my hacky but necessary
        text = this.add.text(square.x - 25, square.y - 30, letters[i], { font: "55px Karla", fill: '#000000' });
      }
      else {
        text = this.add.text(square.x - 15, square.y - 30, letters[i], { font: "55px Karla", fill: '#000000' });
      }
      textBoxes.push(text);
      square.setInteractive();
      squares.push(square);
    }
    // don't look at this plz, so dumb but i'm in a rush, will fix later
    // loop doesn't work because it looks up last value of i when it calls the function
    squares[0].on('pointerup', function() {
      enterLetter(0);
    });
    squares[1].on('pointerup', function() {
      enterLetter(1);
    });
    squares[2].on('pointerup', function() {
      enterLetter(2);
    });
    squares[3].on('pointerup', function() {
      enterLetter(3);
    });
    squares[4].on('pointerup', function() {
      enterLetter(4);
    });
    squares[5].on('pointerup', function() {
      enterLetter(5);
    });
    squares[6].on('pointerup', function() {
      enterLetter(6);
    });
    squares[7].on('pointerup', function() {
      enterLetter(7);
    });
    squares[8].on('pointerup', function() {
      enterLetter(8);
    });
  }

  function enterLetter(i) {
    if(i == 7) {
      back();
    }
    else if (i == 8) {
      shuffle();
    }
    else {
      addLetter(letters[i]);
    }
  }

  function back() {
    string = string.slice(0, -1);
    currentWord.setText(string);
  }

  function shuffle() {
    Phaser.Utils.Array.Shuffle(freeLetters);
    // what a mess
    for(i = 0; i < 4; i++) {
      letters[i] = freeLetters[i];
    }
    for(i = 5; i < 7; i++) {
      letters[i] = freeLetters[i-1]
    }
    for(i = 0; i < textBoxes.length; i++) {
      textBoxes[i].setText(letters[i]);
    }
  }

  function addLetter(letter) {
    string += letter;
    currentWord.setText(string);
  }


  async function check ()
  {
    var bad = false;
    var message = "";
    if(string.length <= 3) {
      message = "too short";
      bad = true;
    }

    else if(!string.includes(letters[4])) {
      message = "missing " + "'" + letters[4] + "'";
      bad = true;
    }

    else if (!words.has(string)) {
      message = "invalid word";
      bad = true;
    }

    if (bad) {
      currentWord.setText(message);
      camera.shake(1000, 0.005);
      await sleep(1000);
      currentWord.setText(string);
      return;
    }
    else {
      currentWord.setText("nice!");
      currentWord.fill = '0xF5C50B';
      await sleep(1000);
      string = "";
      currentWord.setText(string);
    }
  }


  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }



</script>

</body>
</html>